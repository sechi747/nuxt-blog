__NUXT_JSONP__("/posts/20220414-%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E5%92%8C%E6%89%A7%E8%A1%8C%E6%A0%88", {data:[{article:Object.create(null,{default:{writable:true,enumerable:true,value:{attributes:{title:"执行上下文和执行栈",date:"2022\u002F04\u002F14 17:31:40",updated:"2022\u002F04\u002F14 17:31:40",categories:["技术"],tags:["Vanilla JS"]},html:"\u003Cp\u003E其实这篇文章更像是个读书笔记，只不过掺杂了一点点个人理解。文章讨论的东西并不深入，但单纯用来理解概念也还够用。虽然实际开发中不会用到这些概念，但是可以为后面理解闭包等概念铺路。\u003C\u002Fp\u003E\n\u003Ch1\u003E执行上下文的概念\u003C\u002Fh1\u003E\n\u003Cp\u003E简而言之，执行上下文（Execution Context）是评估和执行 JavaScript 代码的环境的抽象概念。每当 JavaScript 代码在运行的时候，它都是在执行上下文中运行。它有三种类型：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E全局执行上下文：这是基础的上下文，任何不再函数内部的代码都在全局上下文中。它会执行两件事：① 创建一个全局的 \u003Ccode\u003EWindow\u003C\u002Fcode\u003E 对象。② 设置 \u003Ccode\u003Ethis\u003C\u002Fcode\u003E 的值等于这个全局对象。一个程序只能有一个全局上下文。\u003C\u002Fli\u003E\n\u003Cli\u003E函数执行上下文：每当函数被调用时都会给这个函数创建一个新的上下文。每个函数都有自己的执行上下文，它会在函数\u003Cstrong\u003E被调用时\u003C\u002Fstrong\u003E创建而不是被定义时创建。\u003C\u002Fli\u003E\n\u003Cli\u003EEval 函数执行上下文：执行在 \u003Ccode\u003Eeval\u003C\u002Fcode\u003E 函数内部的代码也会有属于自己的执行上下文。\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch1\u003E执行栈的概念\u003C\u002Fh1\u003E\n\u003Cp\u003E执行栈（Execution Stack），在其它编程语言中也会被称为“调用栈”，是一种拥有 LIFO（Last In First Out）数据结构的栈，被用来存储代码运行时创建的所有\u003Cstrong\u003E执行上下文\u003C\u002Fstrong\u003E。\u003C\u002Fp\u003E\n\u003Cp\u003E在 JS 引擎执行代码时，它会首先创建一个全局执行上下文并压入执行栈。每当调用一个函数时，它就会为该函数创建一个新的执行上下文并压入栈底。\u003C\u002Fp\u003E\n\u003Cp\u003EJS 引擎会执行那些上下文位于栈顶的函数，当该函数执行完毕时，执行上下文会从栈中弹出，然后会再次重复上述动作，直到所有函数执行完毕。\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token keyword\"\u003Elet\u003C\u002Fspan\u003E a \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E'Hello World!'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Efirst\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token console class-name\"\u003Econsole\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token method function property-access\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E'Inside first function'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token function\"\u003Esecond\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token console class-name\"\u003Econsole\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token method function property-access\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E'Again inside first function'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Esecond\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token console class-name\"\u003Econsole\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token method function property-access\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E'Inside second function'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token function\"\u003Efirst\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token console class-name\"\u003Econsole\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token method function property-access\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E'Inside Global Execution Context'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fpic-go-20220331-1301395896.cos.ap-beijing.myqcloud.com\u002Fimg\u002Fimage-20220414155143708.png\" alt=\"image-20220414155143708\"\u003E\u003C\u002Fp\u003E\n\u003Ch1\u003E执行上下文是怎么被创建的？\u003C\u002Fh1\u003E\n\u003Cp\u003E创建执行上下文有两个阶段：① \u003Cstrong\u003E创建阶段\u003C\u002Fstrong\u003E ② \u003Cstrong\u003E执行阶段\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Ch2\u003E创建阶段\u003C\u002Fh2\u003E\n\u003Cp\u003E执行上下文在创建阶段会发生两件事：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Cstrong\u003E词法环境\u003C\u002Fstrong\u003E组件被创建\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cstrong\u003E变量环境\u003C\u002Fstrong\u003E组件被创建\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E在概念上可以表现为以下代码：\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token maybe-class-name\"\u003EExecutionContext\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token maybe-class-name\"\u003ELexicalEnvironment\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003Eref\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E \u003Cspan class=\"token property-access\"\u003Eto\u003C\u002Fspan\u003E \u003Cspan class=\"token maybe-class-name\"\u003ELexicalEnvironment\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Ein\u003C\u002Fspan\u003E memory\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token maybe-class-name\"\u003EVariableEnvironment\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003Eref\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E \u003Cspan class=\"token property-access\"\u003Eto\u003C\u002Fspan\u003E \u003Cspan class=\"token maybe-class-name\"\u003EVariableEnvironment\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Ein\u003C\u002Fspan\u003E  memory\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3\u003E词法环境\u003C\u002Fh3\u003E\n\u003Cp\u003EES6 的文档中把词法环境定义为：\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E\u003Cstrong\u003E词法环境\u003C\u002Fstrong\u003E是一种规范类型，基于 ECMAScript 代码的词法嵌套结构来定义\u003Cstrong\u003E标识符\u003C\u002Fstrong\u003E和具体变量和函数的关联。一个词法环境由环境记录器和一个可能的引用\u003Cstrong\u003E外部\u003C\u002Fstrong\u003E词法环境的空值组成。\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003E简单来讲\u003Cstrong\u003E词法环境\u003C\u002Fstrong\u003E是一种持有\u003Cstrong\u003E标识符——变量映射\u003C\u002Fstrong\u003E的结构。\u003Cstrong\u003E标识符\u003C\u002Fstrong\u003E就是指变量\u002F函数的名字，而\u003Cstrong\u003E变量\u003C\u002Fstrong\u003E则是对实际对象（也包括函数和数组）或原始数据的引用。\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token keyword\"\u003Evar\u003C\u002Fspan\u003E a \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Evar\u003C\u002Fspan\u003E b \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E40\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Efoo\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token console class-name\"\u003Econsole\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token method function property-access\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E'bar'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E上面的代码的词法环境大概长这样：\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token maybe-class-name\"\u003ELexicalEnvironment\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token literal-property property\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token literal-property property\"\u003Eb\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E40\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token literal-property property\"\u003Efoo\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003Eref\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E \u003Cspan class=\"token property-access\"\u003Eto\u003C\u002Fspan\u003E foo \u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E每个词法环境有三个组件：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E环境记录器\u003C\u002Fli\u003E\n\u003Cli\u003E外部环境的引用\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Ethis\u003C\u002Fcode\u003E 绑定\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch4\u003E环境记录器\u003C\u002Fh4\u003E\n\u003Cp\u003E环境记录器是词法环境内部\u003Cstrong\u003E存储变量和函数声明\u003C\u002Fstrong\u003E的地方。\u003C\u002Fp\u003E\n\u003Cp\u003E环境记录器具有两种类型：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Cstrong\u003E声明式环境记录器\u003C\u002Fstrong\u003E——函数的词法环境会包含一个声明式环境记录器。用来存储变量和函数声明。\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cstrong\u003E对象环境记录器\u003C\u002Fstrong\u003E——全局代码的词法环境会包含一个对象环境记录器。除了变量和函数声明，对象环境记录器还会存储一个全局绑定对象（在浏览器中也就是 Window 对象）。所以对于每个绑定对象的属性（如果是在浏览器中，会包含一些浏览器提供的属性和方法，如BOM等）都会在记录器中创建一个新的条目（原文是 entry，不知道该怎么翻译）。\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E注意：对于函数代码，环境记录器还会包含一个\u003Cstrong\u003E参数（arguments）对象\u003C\u002Fstrong\u003E，它包含了传递给该函数的“\u003Cstrong\u003E索引--参数映射\u003C\u002Fstrong\u003E”以及\u003Cstrong\u003E参数的长度\u003C\u002Fstrong\u003E。例如下面的函数的参数对象大概长这样：\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Efoo\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token parameter\"\u003Ea\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E b\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token keyword\"\u003Evar\u003C\u002Fspan\u003E c \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E a \u003Cspan class=\"token operator\"\u003E+\u003C\u002Fspan\u003E b\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"token function\"\u003Efoo\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F argument object\u003C\u002Fspan\u003E\n\u003Cspan class=\"token literal-property property\"\u003EArguments\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token literal-property property\"\u003Elength\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E简而言之，\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E在\u003Cstrong\u003E全局环境\u003C\u002Fstrong\u003E中，环境记录器是对象环境记录器。\u003C\u002Fli\u003E\n\u003Cli\u003E在\u003Cstrong\u003E函数环境\u003C\u002Fstrong\u003E中，环境记录器是声明式环境记录器。\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch4\u003E外部环境的引用\u003C\u002Fh4\u003E\n\u003Cp\u003E外部环境的引用意味着一个词法环境可以访问到它外部的词法环境。也就是说如果 JS 引擎在当前的词法环境中无法找到一个变量，那么它可以去外部的词法环境中继续查找。我个人的理解是，这其实和作用域链很像，如果在当前作用域找不到一个变量的定义，那么会一层一层地向上查找，直到全局作用域。\u003C\u002Fp\u003E\n\u003Ch4\u003Ethis 绑定\u003C\u002Fh4\u003E\n\u003Cp\u003E这个组件就是用来进行 \u003Ccode\u003Ethis\u003C\u002Fcode\u003E 绑定的。\u003C\u002Fp\u003E\n\u003Cp\u003E如果是全局执行上下文的话， \u003Ccode\u003Ethis\u003C\u002Fcode\u003E 会指向全局对象。（在浏览器中也就是 Window 对象）\u003C\u002Fp\u003E\n\u003Cp\u003E如果是函数执行上下文的话，\u003Ccode\u003Ethis\u003C\u002Fcode\u003E 的值会取决于函数是如何被调用的（此处不包含\u003Cstrong\u003E箭头函数\u003C\u002Fstrong\u003E，箭头函数的 \u003Ccode\u003Ethis\u003C\u002Fcode\u003E 指向取决于函数是在哪里被定义的）。如果它是被一个引用对象调用，那么 \u003Ccode\u003Ethis\u003C\u002Fcode\u003E 会被设置为那个对象，否则 \u003Ccode\u003Ethis\u003C\u002Fcode\u003E 的值会被设置为全局对象。（严格模式下则是 \u003Ccode\u003Eundefined\u003C\u002Fcode\u003E）以下面代码为例：\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E person \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token literal-property property\"\u003Ename\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E'peter'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token literal-property property\"\u003EbirthYear\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E1994\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token function-variable function\"\u003EcalcAge\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token console class-name\"\u003Econsole\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token method function property-access\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E2018\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token property-access\"\u003EbirthYear\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\nperson\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token method function property-access\"\u003EcalcAge\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E \n\u003Cspan class=\"token comment\"\u003E\u002F\u002F 'this' refers to 'person', because 'calcAge' was called with 'person' object reference\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E calculateAge \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E person\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token property-access\"\u003EcalcAge\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token function\"\u003EcalculateAge\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F 'this' refers to the global window object, because no object reference was given\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E抽象地讲，词法环境的伪代码大概长这样：\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobalExectionContext\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token literal-property property\"\u003ELexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Object\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword null nil\"\u003Enull\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003Eglobal object\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"token maybe-class-name\"\u003EFunctionExectionContext\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token literal-property property\"\u003ELexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Declarative\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobal\u003C\u002Fspan\u003E or outer \u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E environment reference\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003Edepends on how \u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E is called\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3\u003E变量环境\u003C\u002Fh3\u003E\n\u003Cp\u003E变量环境其实也是一个词法环境，它的环境记录器持有\u003Cstrong\u003E变量声明语句\u003C\u002Fstrong\u003E在执行上下文中创建的绑定关系。\u003C\u002Fp\u003E\n\u003Cp\u003E所以变量环境有着词法环境的所有属性和组件。\u003C\u002Fp\u003E\n\u003Cp\u003E在 ES6 中，词法环境和变量环境的唯一区别就是：词法环境会存储所有由 \u003Ccode\u003Elet\u003C\u002Fcode\u003E 和 \u003Ccode\u003Econst\u003C\u002Fcode\u003E 定义的变量绑定和函数声明。而变量环境只存储由 \u003Ccode\u003Evar\u003C\u002Fcode\u003E 定义的变量绑定。\u003C\u002Fp\u003E\n\u003Ch2\u003E执行阶段\u003C\u002Fh2\u003E\n\u003Cp\u003E在执行阶段，完成对所有这些变量的分配后并最终执行代码。\u003C\u002Fp\u003E\n\u003Ch2\u003E例子\u003C\u002Fh2\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token keyword\"\u003Elet\u003C\u002Fspan\u003E a \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E b \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E30\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Evar\u003C\u002Fspan\u003E c\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Emultiply\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token parameter\"\u003Ee\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E f\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n \u003Cspan class=\"token keyword\"\u003Evar\u003C\u002Fspan\u003E g \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n \u003Cspan class=\"token keyword control-flow\"\u003Ereturn\u003C\u002Fspan\u003E e \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003E f \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003E g\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\nc \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Emultiply\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E30\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E当上面的代码被执行时，JS 引擎会创建一个全局执行上下文来执行全局代码。在创建阶段时全局执行上下文大概长这样：\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobalExectionContext\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token literal-property property\"\u003ELexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Object\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E uninitialized \u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Eb\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E uninitialized \u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Emultiply\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E func \u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword null nil\"\u003Enull\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EThisBinding\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobal\u003C\u002Fspan\u003E \u003Cspan class=\"token known-class-name class-name\"\u003EObject\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token literal-property property\"\u003EVariableEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Object\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword nil\"\u003Eundefined\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword null nil\"\u003Enull\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EThisBinding\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobal\u003C\u002Fspan\u003E \u003Cspan class=\"token known-class-name class-name\"\u003EObject\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E在执行阶段时全局执行上下文大概长这样：\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobalExectionContext\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan class=\"token literal-property property\"\u003ELexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Object\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Eb\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E30\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Emultiply\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E func \u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword null nil\"\u003Enull\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EThisBinding\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobal\u003C\u002Fspan\u003E \u003Cspan class=\"token known-class-name class-name\"\u003EObject\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\u003Cspan class=\"token literal-property property\"\u003EVariableEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Object\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword nil\"\u003Eundefined\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword null nil\"\u003Enull\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EThisBinding\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobal\u003C\u002Fspan\u003E \u003Cspan class=\"token known-class-name class-name\"\u003EObject\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E当代码执行到 \u003Ccode\u003Emultiply(20, 30)\u003C\u002Fcode\u003E 时，JS 引擎会创建一个新的函数执行上下文来执行该函数。在创建阶段这个函数执行上下文大概长这样：\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token maybe-class-name\"\u003EFunctionExectionContext\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan class=\"token literal-property property\"\u003ELexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Declarative\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EArguments\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E30\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token literal-property property\"\u003Elength\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobalLexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EThisBinding\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobal\u003C\u002Fspan\u003E \u003Cspan class=\"token known-class-name class-name\"\u003EObject\u003C\u002Fspan\u003E or \u003Cspan class=\"token keyword nil\"\u003Eundefined\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\u003Cspan class=\"token literal-property property\"\u003EVariableEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Declarative\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Eg\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword nil\"\u003Eundefined\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobalLexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EThisBinding\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobal\u003C\u002Fspan\u003E \u003Cspan class=\"token known-class-name class-name\"\u003EObject\u003C\u002Fspan\u003E or \u003Cspan class=\"token keyword nil\"\u003Eundefined\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E完成创建阶段之后，函数执行上下文进入执行阶段，也就是说对函数内部的变量的赋值操作已经完成，所以在执行阶段该函数执行上下文大概长这样：\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token maybe-class-name\"\u003EFunctionExectionContext\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan class=\"token literal-property property\"\u003ELexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Declarative\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EArguments\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E30\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token literal-property property\"\u003Elength\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobalLexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EThisBinding\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobal\u003C\u002Fspan\u003E \u003Cspan class=\"token known-class-name class-name\"\u003EObject\u003C\u002Fspan\u003E or \u003Cspan class=\"token keyword nil\"\u003Eundefined\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\u003Cspan class=\"token literal-property property\"\u003EVariableEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Declarative\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Eg\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E20\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobalLexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EThisBinding\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobal\u003C\u002Fspan\u003E \u003Cspan class=\"token known-class-name class-name\"\u003EObject\u003C\u002Fspan\u003E or \u003Cspan class=\"token keyword nil\"\u003Eundefined\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E在这个函数执行完之后，函数的返回值被存储到了 \u003Ccode\u003Ec\u003C\u002Fcode\u003E 中，对应地全局词法环境中的 \u003Ccode\u003Ec\u003C\u002Fcode\u003E 的值也被更新了。至此，全局代码被全部运行，这段程序也就结束了。\u003C\u002Fp\u003E\n\u003Cp\u003E**注意：**在上面的词法环境伪代码中，\u003Ccode\u003Elet\u003C\u002Fcode\u003E 和 \u003Ccode\u003Econst\u003C\u002Fcode\u003E 定义的变量在创建阶段都是 \u003Ccode\u003E&lt; uninitialized &gt;\u003C\u002Fcode\u003E ，而 \u003Ccode\u003Evar\u003C\u002Fcode\u003E 定义的变量则被赋予了 \u003Ccode\u003Eundefined\u003C\u002Fcode\u003E。这是因为在创建阶段，JS 引擎会检查代码中的变量和函数的声明。函数声明会被完整地存储在环境中，而变量则会被设置为 \u003Ccode\u003Eundefined\u003C\u002Fcode\u003E （使用 \u003Ccode\u003Evar\u003C\u002Fcode\u003E 定义）或者保持未初始化状态（使用 \u003Ccode\u003Elet\u003C\u002Fcode\u003E 和 \u003Ccode\u003Econst\u003C\u002Fcode\u003E 定义）。\u003C\u002Fp\u003E\n\u003Cp\u003E这也就是为什么我们可以在声明之前访问到 \u003Ccode\u003Evar\u003C\u002Fcode\u003E 定义的变量，但当我们尝试在声明之前访问 \u003Ccode\u003Elet\u003C\u002Fcode\u003E 和 \u003Ccode\u003Econst\u003C\u002Fcode\u003E 变量时会得到一个 \u003Ccode\u003EReferenceError\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\n\u003Ch1\u003E参考文章\u003C\u002Fh1\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fjuejin.cn\u002Fpost\u002F6844903682283143181\"\u003E[译] 理解 JavaScript 中的执行上下文和执行栈\u003C\u002Fa\u003E 以及它的原文 \u003Ca href=\"https:\u002F\u002Fmedium.com\u002Fbitsrc\u002Funderstanding-execution-context-and-execution-stack-in-javascript-1c9ea8642dd0\"\u003EUnderstanding Execution Context and Execution Stack in Javascript\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n"}},attributes:{writable:true,enumerable:true,value:{title:"执行上下文和执行栈",date:"2022\u002F04\u002F14 17:31:40",updated:"2022\u002F04\u002F14 17:31:40",categories:["技术"],tags:["Vanilla JS"]}},html:{writable:true,enumerable:true,value:"\u003Cp\u003E其实这篇文章更像是个读书笔记，只不过掺杂了一点点个人理解。文章讨论的东西并不深入，但单纯用来理解概念也还够用。虽然实际开发中不会用到这些概念，但是可以为后面理解闭包等概念铺路。\u003C\u002Fp\u003E\n\u003Ch1\u003E执行上下文的概念\u003C\u002Fh1\u003E\n\u003Cp\u003E简而言之，执行上下文（Execution Context）是评估和执行 JavaScript 代码的环境的抽象概念。每当 JavaScript 代码在运行的时候，它都是在执行上下文中运行。它有三种类型：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E全局执行上下文：这是基础的上下文，任何不再函数内部的代码都在全局上下文中。它会执行两件事：① 创建一个全局的 \u003Ccode\u003EWindow\u003C\u002Fcode\u003E 对象。② 设置 \u003Ccode\u003Ethis\u003C\u002Fcode\u003E 的值等于这个全局对象。一个程序只能有一个全局上下文。\u003C\u002Fli\u003E\n\u003Cli\u003E函数执行上下文：每当函数被调用时都会给这个函数创建一个新的上下文。每个函数都有自己的执行上下文，它会在函数\u003Cstrong\u003E被调用时\u003C\u002Fstrong\u003E创建而不是被定义时创建。\u003C\u002Fli\u003E\n\u003Cli\u003EEval 函数执行上下文：执行在 \u003Ccode\u003Eeval\u003C\u002Fcode\u003E 函数内部的代码也会有属于自己的执行上下文。\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch1\u003E执行栈的概念\u003C\u002Fh1\u003E\n\u003Cp\u003E执行栈（Execution Stack），在其它编程语言中也会被称为“调用栈”，是一种拥有 LIFO（Last In First Out）数据结构的栈，被用来存储代码运行时创建的所有\u003Cstrong\u003E执行上下文\u003C\u002Fstrong\u003E。\u003C\u002Fp\u003E\n\u003Cp\u003E在 JS 引擎执行代码时，它会首先创建一个全局执行上下文并压入执行栈。每当调用一个函数时，它就会为该函数创建一个新的执行上下文并压入栈底。\u003C\u002Fp\u003E\n\u003Cp\u003EJS 引擎会执行那些上下文位于栈顶的函数，当该函数执行完毕时，执行上下文会从栈中弹出，然后会再次重复上述动作，直到所有函数执行完毕。\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token keyword\"\u003Elet\u003C\u002Fspan\u003E a \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E'Hello World!'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Efirst\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token console class-name\"\u003Econsole\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token method function property-access\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E'Inside first function'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token function\"\u003Esecond\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token console class-name\"\u003Econsole\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token method function property-access\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E'Again inside first function'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Esecond\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token console class-name\"\u003Econsole\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token method function property-access\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E'Inside second function'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\n\u003Cspan class=\"token function\"\u003Efirst\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token console class-name\"\u003Econsole\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token method function property-access\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E'Inside Global Execution Context'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E\u003Cimg src=\"https:\u002F\u002Fpic-go-20220331-1301395896.cos.ap-beijing.myqcloud.com\u002Fimg\u002Fimage-20220414155143708.png\" alt=\"image-20220414155143708\"\u003E\u003C\u002Fp\u003E\n\u003Ch1\u003E执行上下文是怎么被创建的？\u003C\u002Fh1\u003E\n\u003Cp\u003E创建执行上下文有两个阶段：① \u003Cstrong\u003E创建阶段\u003C\u002Fstrong\u003E ② \u003Cstrong\u003E执行阶段\u003C\u002Fstrong\u003E\u003C\u002Fp\u003E\n\u003Ch2\u003E创建阶段\u003C\u002Fh2\u003E\n\u003Cp\u003E执行上下文在创建阶段会发生两件事：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Cstrong\u003E词法环境\u003C\u002Fstrong\u003E组件被创建\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cstrong\u003E变量环境\u003C\u002Fstrong\u003E组件被创建\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E在概念上可以表现为以下代码：\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token maybe-class-name\"\u003EExecutionContext\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token maybe-class-name\"\u003ELexicalEnvironment\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003Eref\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E \u003Cspan class=\"token property-access\"\u003Eto\u003C\u002Fspan\u003E \u003Cspan class=\"token maybe-class-name\"\u003ELexicalEnvironment\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Ein\u003C\u002Fspan\u003E memory\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token maybe-class-name\"\u003EVariableEnvironment\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003Eref\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E \u003Cspan class=\"token property-access\"\u003Eto\u003C\u002Fspan\u003E \u003Cspan class=\"token maybe-class-name\"\u003EVariableEnvironment\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Ein\u003C\u002Fspan\u003E  memory\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3\u003E词法环境\u003C\u002Fh3\u003E\n\u003Cp\u003EES6 的文档中把词法环境定义为：\u003C\u002Fp\u003E\n\u003Cblockquote\u003E\n\u003Cp\u003E\u003Cstrong\u003E词法环境\u003C\u002Fstrong\u003E是一种规范类型，基于 ECMAScript 代码的词法嵌套结构来定义\u003Cstrong\u003E标识符\u003C\u002Fstrong\u003E和具体变量和函数的关联。一个词法环境由环境记录器和一个可能的引用\u003Cstrong\u003E外部\u003C\u002Fstrong\u003E词法环境的空值组成。\u003C\u002Fp\u003E\n\u003C\u002Fblockquote\u003E\n\u003Cp\u003E简单来讲\u003Cstrong\u003E词法环境\u003C\u002Fstrong\u003E是一种持有\u003Cstrong\u003E标识符——变量映射\u003C\u002Fstrong\u003E的结构。\u003Cstrong\u003E标识符\u003C\u002Fstrong\u003E就是指变量\u002F函数的名字，而\u003Cstrong\u003E变量\u003C\u002Fstrong\u003E则是对实际对象（也包括函数和数组）或原始数据的引用。\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token keyword\"\u003Evar\u003C\u002Fspan\u003E a \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Evar\u003C\u002Fspan\u003E b \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E40\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Efoo\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token console class-name\"\u003Econsole\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token method function property-access\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token string\"\u003E'bar'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E上面的代码的词法环境大概长这样：\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token maybe-class-name\"\u003ELexicalEnvironment\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token literal-property property\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token literal-property property\"\u003Eb\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E40\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token literal-property property\"\u003Efoo\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003Eref\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E \u003Cspan class=\"token property-access\"\u003Eto\u003C\u002Fspan\u003E foo \u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E每个词法环境有三个组件：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E环境记录器\u003C\u002Fli\u003E\n\u003Cli\u003E外部环境的引用\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Ccode\u003Ethis\u003C\u002Fcode\u003E 绑定\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch4\u003E环境记录器\u003C\u002Fh4\u003E\n\u003Cp\u003E环境记录器是词法环境内部\u003Cstrong\u003E存储变量和函数声明\u003C\u002Fstrong\u003E的地方。\u003C\u002Fp\u003E\n\u003Cp\u003E环境记录器具有两种类型：\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Cstrong\u003E声明式环境记录器\u003C\u002Fstrong\u003E——函数的词法环境会包含一个声明式环境记录器。用来存储变量和函数声明。\u003C\u002Fli\u003E\n\u003Cli\u003E\u003Cstrong\u003E对象环境记录器\u003C\u002Fstrong\u003E——全局代码的词法环境会包含一个对象环境记录器。除了变量和函数声明，对象环境记录器还会存储一个全局绑定对象（在浏览器中也就是 Window 对象）。所以对于每个绑定对象的属性（如果是在浏览器中，会包含一些浏览器提供的属性和方法，如BOM等）都会在记录器中创建一个新的条目（原文是 entry，不知道该怎么翻译）。\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Cp\u003E注意：对于函数代码，环境记录器还会包含一个\u003Cstrong\u003E参数（arguments）对象\u003C\u002Fstrong\u003E，它包含了传递给该函数的“\u003Cstrong\u003E索引--参数映射\u003C\u002Fstrong\u003E”以及\u003Cstrong\u003E参数的长度\u003C\u002Fstrong\u003E。例如下面的函数的参数对象大概长这样：\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Efoo\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token parameter\"\u003Ea\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E b\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token keyword\"\u003Evar\u003C\u002Fspan\u003E c \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E a \u003Cspan class=\"token operator\"\u003E+\u003C\u002Fspan\u003E b\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"token function\"\u003Efoo\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F argument object\u003C\u002Fspan\u003E\n\u003Cspan class=\"token literal-property property\"\u003EArguments\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E3\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token literal-property property\"\u003Elength\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E简而言之，\u003C\u002Fp\u003E\n\u003Cul\u003E\n\u003Cli\u003E在\u003Cstrong\u003E全局环境\u003C\u002Fstrong\u003E中，环境记录器是对象环境记录器。\u003C\u002Fli\u003E\n\u003Cli\u003E在\u003Cstrong\u003E函数环境\u003C\u002Fstrong\u003E中，环境记录器是声明式环境记录器。\u003C\u002Fli\u003E\n\u003C\u002Ful\u003E\n\u003Ch4\u003E外部环境的引用\u003C\u002Fh4\u003E\n\u003Cp\u003E外部环境的引用意味着一个词法环境可以访问到它外部的词法环境。也就是说如果 JS 引擎在当前的词法环境中无法找到一个变量，那么它可以去外部的词法环境中继续查找。我个人的理解是，这其实和作用域链很像，如果在当前作用域找不到一个变量的定义，那么会一层一层地向上查找，直到全局作用域。\u003C\u002Fp\u003E\n\u003Ch4\u003Ethis 绑定\u003C\u002Fh4\u003E\n\u003Cp\u003E这个组件就是用来进行 \u003Ccode\u003Ethis\u003C\u002Fcode\u003E 绑定的。\u003C\u002Fp\u003E\n\u003Cp\u003E如果是全局执行上下文的话， \u003Ccode\u003Ethis\u003C\u002Fcode\u003E 会指向全局对象。（在浏览器中也就是 Window 对象）\u003C\u002Fp\u003E\n\u003Cp\u003E如果是函数执行上下文的话，\u003Ccode\u003Ethis\u003C\u002Fcode\u003E 的值会取决于函数是如何被调用的（此处不包含\u003Cstrong\u003E箭头函数\u003C\u002Fstrong\u003E，箭头函数的 \u003Ccode\u003Ethis\u003C\u002Fcode\u003E 指向取决于函数是在哪里被定义的）。如果它是被一个引用对象调用，那么 \u003Ccode\u003Ethis\u003C\u002Fcode\u003E 会被设置为那个对象，否则 \u003Ccode\u003Ethis\u003C\u002Fcode\u003E 的值会被设置为全局对象。（严格模式下则是 \u003Ccode\u003Eundefined\u003C\u002Fcode\u003E）以下面代码为例：\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E person \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token literal-property property\"\u003Ename\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E'peter'\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token literal-property property\"\u003EbirthYear\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E1994\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token function-variable function\"\u003EcalcAge\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token console class-name\"\u003Econsole\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token method function property-access\"\u003Elog\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E2018\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E-\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token property-access\"\u003EbirthYear\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\nperson\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token method function property-access\"\u003EcalcAge\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E \n\u003Cspan class=\"token comment\"\u003E\u002F\u002F 'this' refers to 'person', because 'calcAge' was called with 'person' object reference\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E calculateAge \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E person\u003Cspan class=\"token punctuation\"\u003E.\u003C\u002Fspan\u003E\u003Cspan class=\"token property-access\"\u003EcalcAge\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token function\"\u003EcalculateAge\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token comment\"\u003E\u002F\u002F 'this' refers to the global window object, because no object reference was given\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E抽象地讲，词法环境的伪代码大概长这样：\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobalExectionContext\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token literal-property property\"\u003ELexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Object\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword null nil\"\u003Enull\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003Eglobal object\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"token maybe-class-name\"\u003EFunctionExectionContext\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token literal-property property\"\u003ELexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Declarative\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobal\u003C\u002Fspan\u003E or outer \u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E environment reference\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token keyword\"\u003Ethis\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003Edepends on how \u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E is called\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Ch3\u003E变量环境\u003C\u002Fh3\u003E\n\u003Cp\u003E变量环境其实也是一个词法环境，它的环境记录器持有\u003Cstrong\u003E变量声明语句\u003C\u002Fstrong\u003E在执行上下文中创建的绑定关系。\u003C\u002Fp\u003E\n\u003Cp\u003E所以变量环境有着词法环境的所有属性和组件。\u003C\u002Fp\u003E\n\u003Cp\u003E在 ES6 中，词法环境和变量环境的唯一区别就是：词法环境会存储所有由 \u003Ccode\u003Elet\u003C\u002Fcode\u003E 和 \u003Ccode\u003Econst\u003C\u002Fcode\u003E 定义的变量绑定和函数声明。而变量环境只存储由 \u003Ccode\u003Evar\u003C\u002Fcode\u003E 定义的变量绑定。\u003C\u002Fp\u003E\n\u003Ch2\u003E执行阶段\u003C\u002Fh2\u003E\n\u003Cp\u003E在执行阶段，完成对所有这些变量的分配后并最终执行代码。\u003C\u002Fp\u003E\n\u003Ch2\u003E例子\u003C\u002Fh2\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token keyword\"\u003Elet\u003C\u002Fspan\u003E a \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Econst\u003C\u002Fspan\u003E b \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E30\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Evar\u003C\u002Fspan\u003E c\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token keyword\"\u003Efunction\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Emultiply\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token parameter\"\u003Ee\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E f\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n \u003Cspan class=\"token keyword\"\u003Evar\u003C\u002Fspan\u003E g \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n \u003Cspan class=\"token keyword control-flow\"\u003Ereturn\u003C\u002Fspan\u003E e \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003E f \u003Cspan class=\"token operator\"\u003E*\u003C\u002Fspan\u003E g\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\nc \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token function\"\u003Emultiply\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E(\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E30\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E)\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E;\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E当上面的代码被执行时，JS 引擎会创建一个全局执行上下文来执行全局代码。在创建阶段时全局执行上下文大概长这样：\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobalExectionContext\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token literal-property property\"\u003ELexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Object\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E uninitialized \u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Eb\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E uninitialized \u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Emultiply\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E func \u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword null nil\"\u003Enull\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EThisBinding\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobal\u003C\u002Fspan\u003E \u003Cspan class=\"token known-class-name class-name\"\u003EObject\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token literal-property property\"\u003EVariableEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Object\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword nil\"\u003Eundefined\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword null nil\"\u003Enull\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EThisBinding\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobal\u003C\u002Fspan\u003E \u003Cspan class=\"token known-class-name class-name\"\u003EObject\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E在执行阶段时全局执行上下文大概长这样：\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobalExectionContext\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan class=\"token literal-property property\"\u003ELexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Object\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Ea\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Eb\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E30\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Emultiply\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E func \u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword null nil\"\u003Enull\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EThisBinding\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobal\u003C\u002Fspan\u003E \u003Cspan class=\"token known-class-name class-name\"\u003EObject\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\u003Cspan class=\"token literal-property property\"\u003EVariableEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Object\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Ec\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword nil\"\u003Eundefined\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token keyword null nil\"\u003Enull\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EThisBinding\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobal\u003C\u002Fspan\u003E \u003Cspan class=\"token known-class-name class-name\"\u003EObject\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E当代码执行到 \u003Ccode\u003Emultiply(20, 30)\u003C\u002Fcode\u003E 时，JS 引擎会创建一个新的函数执行上下文来执行该函数。在创建阶段这个函数执行上下文大概长这样：\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token maybe-class-name\"\u003EFunctionExectionContext\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan class=\"token literal-property property\"\u003ELexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Declarative\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EArguments\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E30\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token literal-property property\"\u003Elength\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobalLexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EThisBinding\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobal\u003C\u002Fspan\u003E \u003Cspan class=\"token known-class-name class-name\"\u003EObject\u003C\u002Fspan\u003E or \u003Cspan class=\"token keyword nil\"\u003Eundefined\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\u003Cspan class=\"token literal-property property\"\u003EVariableEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Declarative\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Eg\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token keyword nil\"\u003Eundefined\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobalLexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EThisBinding\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobal\u003C\u002Fspan\u003E \u003Cspan class=\"token known-class-name class-name\"\u003EObject\u003C\u002Fspan\u003E or \u003Cspan class=\"token keyword nil\"\u003Eundefined\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E完成创建阶段之后，函数执行上下文进入执行阶段，也就是说对函数内部的变量的赋值操作已经完成，所以在执行阶段该函数执行上下文大概长这样：\u003C\u002Fp\u003E\n\u003Cpre class=\"language-js\"\u003E\u003Ccode class=\"language-js\"\u003E\u003Cspan class=\"token maybe-class-name\"\u003EFunctionExectionContext\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E=\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n\u003Cspan class=\"token literal-property property\"\u003ELexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Declarative\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EArguments\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\u003Cspan class=\"token number\"\u003E0\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E20\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E1\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E30\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E \u003Cspan class=\"token literal-property property\"\u003Elength\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E2\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobalLexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EThisBinding\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobal\u003C\u002Fspan\u003E \u003Cspan class=\"token known-class-name class-name\"\u003EObject\u003C\u002Fspan\u003E or \u003Cspan class=\"token keyword nil\"\u003Eundefined\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n\u003Cspan class=\"token literal-property property\"\u003EVariableEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EEnvironmentRecord\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token punctuation\"\u003E{\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003EType\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token string\"\u003E\"Declarative\"\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token comment\"\u003E\u002F\u002F Identifier bindings go here\u003C\u002Fspan\u003E\n      \u003Cspan class=\"token literal-property property\"\u003Eg\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token number\"\u003E20\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003Eouter\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobalLexicalEnvironment\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\u003Cspan class=\"token punctuation\"\u003E,\u003C\u002Fspan\u003E\n    \u003Cspan class=\"token literal-property property\"\u003EThisBinding\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E:\u003C\u002Fspan\u003E \u003Cspan class=\"token operator\"\u003E&lt;\u003C\u002Fspan\u003E\u003Cspan class=\"token maybe-class-name\"\u003EGlobal\u003C\u002Fspan\u003E \u003Cspan class=\"token known-class-name class-name\"\u003EObject\u003C\u002Fspan\u003E or \u003Cspan class=\"token keyword nil\"\u003Eundefined\u003C\u002Fspan\u003E\u003Cspan class=\"token operator\"\u003E\u003E\u003C\u002Fspan\u003E\n  \u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003Cspan class=\"token punctuation\"\u003E}\u003C\u002Fspan\u003E\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\u003Cp\u003E在这个函数执行完之后，函数的返回值被存储到了 \u003Ccode\u003Ec\u003C\u002Fcode\u003E 中，对应地全局词法环境中的 \u003Ccode\u003Ec\u003C\u002Fcode\u003E 的值也被更新了。至此，全局代码被全部运行，这段程序也就结束了。\u003C\u002Fp\u003E\n\u003Cp\u003E**注意：**在上面的词法环境伪代码中，\u003Ccode\u003Elet\u003C\u002Fcode\u003E 和 \u003Ccode\u003Econst\u003C\u002Fcode\u003E 定义的变量在创建阶段都是 \u003Ccode\u003E&lt; uninitialized &gt;\u003C\u002Fcode\u003E ，而 \u003Ccode\u003Evar\u003C\u002Fcode\u003E 定义的变量则被赋予了 \u003Ccode\u003Eundefined\u003C\u002Fcode\u003E。这是因为在创建阶段，JS 引擎会检查代码中的变量和函数的声明。函数声明会被完整地存储在环境中，而变量则会被设置为 \u003Ccode\u003Eundefined\u003C\u002Fcode\u003E （使用 \u003Ccode\u003Evar\u003C\u002Fcode\u003E 定义）或者保持未初始化状态（使用 \u003Ccode\u003Elet\u003C\u002Fcode\u003E 和 \u003Ccode\u003Econst\u003C\u002Fcode\u003E 定义）。\u003C\u002Fp\u003E\n\u003Cp\u003E这也就是为什么我们可以在声明之前访问到 \u003Ccode\u003Evar\u003C\u002Fcode\u003E 定义的变量，但当我们尝试在声明之前访问 \u003Ccode\u003Elet\u003C\u002Fcode\u003E 和 \u003Ccode\u003Econst\u003C\u002Fcode\u003E 变量时会得到一个 \u003Ccode\u003EReferenceError\u003C\u002Fcode\u003E。\u003C\u002Fp\u003E\n\u003Ch1\u003E参考文章\u003C\u002Fh1\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fjuejin.cn\u002Fpost\u002F6844903682283143181\"\u003E[译] 理解 JavaScript 中的执行上下文和执行栈\u003C\u002Fa\u003E 以及它的原文 \u003Ca href=\"https:\u002F\u002Fmedium.com\u002Fbitsrc\u002Funderstanding-execution-context-and-execution-stack-in-javascript-1c9ea8642dd0\"\u003EUnderstanding Execution Context and Execution Stack in Javascript\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n"}})}],fetch:{},mutations:void 0});